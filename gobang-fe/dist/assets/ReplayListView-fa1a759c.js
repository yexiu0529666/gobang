import{_ as U,u as I,i as p,o as B,r as N,a as o,b as d,d as e,t as i,q as f,F as q,p as E,f as C,w as x,m as H,e as S}from"./index-358441f2.js";const Y={class:"replay-container"},z={key:0,class:"loading-container"},A={key:1,class:"error-message"},Q={key:2,class:"replay-content"},T={class:"filter-bar"},j={class:"filter-options"},G={key:0,class:"replay-grid"},J={class:"replay-card-header"},K={class:"game-id"},O={class:"replay-card-body"},P={class:"players-info"},W={class:"player black-player"},X={class:"player-name"},Z={class:"player white-player"},tt={class:"player-name"},et={class:"game-details"},st={class:"detail-item"},lt={class:"detail-item"},rt={class:"replay-card-footer"},at={key:1,class:"empty-state"},nt={class:"empty-subtitle"},it={__name:"ReplayListView",setup(ot){const _=I(),w=p([]),v=p([]),y=p(!0),b=p(null),g=p(""),u=p("all"),M=async()=>{try{y.value=!0;const s=await H.get("/api/replays");w.value=s.data||[],v.value=[...w.value],y.value=!1}catch(s){console.error("Failed to fetch replays:",s),b.value="无法加载回放数据，请稍后再试",y.value=!1}},D=()=>{var r;const s=g.value.toLowerCase().trim();let t=[...w.value];s&&(t=t.filter(a=>{var n,c,m,h;return((c=(n=a.black_player)==null?void 0:n.username)==null?void 0:c.toLowerCase().includes(s))||((h=(m=a.white_player)==null?void 0:m.username)==null?void 0:h.toLowerCase().includes(s))||a.id.toString().includes(s)}));const l=(r=_.currentUser)==null?void 0:r.id;u.value==="win"&&l?t=t.filter(a=>a.winner&&a.winner.id===l):u.value==="loss"&&l&&(t=t.filter(a=>{var n,c;return a.winner&&a.winner.id!==l&&(((n=a.black_player)==null?void 0:n.id)===l||((c=a.white_player)==null?void 0:c.id)===l)})),v.value=t},k=s=>{u.value=s,D()},$=(s,t="datetime")=>{if(!s)return"未知";const l=new Date(s);return t==="date"?`${l.getFullYear()}-${(l.getMonth()+1).toString().padStart(2,"0")}-${l.getDate().toString().padStart(2,"0")}`:t==="time"?`${l.getHours().toString().padStart(2,"0")}:${l.getMinutes().toString().padStart(2,"0")}`:`${l.getFullYear()}-${(l.getMonth()+1).toString().padStart(2,"0")}-${l.getDate().toString().padStart(2,"0")} ${l.getHours().toString().padStart(2,"0")}:${l.getMinutes().toString().padStart(2,"0")}`},R=(s,t)=>{if(!s||!t)return"未知";const l=new Date(s),a=new Date(t)-l,n=Math.floor(a/(1e3*60)),c=Math.floor(a%(1e3*60)/1e3);return`${n}分${c}秒`},L=s=>{var l,r,a;const t=(l=_.currentUser)==null?void 0:l.id;return s.winner?t&&s.winner.id===t?"你赢了":t&&(((r=s.black_player)==null?void 0:r.id)===t||((a=s.white_player)==null?void 0:a.id)===t)?"你输了":`${s.winner.username} 胜`:"平局"},V=s=>{var l,r,a;const t=(l=_.currentUser)==null?void 0:l.id;return s.winner?t&&s.winner.id===t?"result-win":t&&(((r=s.black_player)==null?void 0:r.id)===t||((a=s.white_player)==null?void 0:a.id)===t)?"result-loss":"result-other":"result-draw"},F=()=>u.value!=="all"||g.value?"没有找到符合条件的对局记录，请尝试其他筛选条件":"快来开始你的第一场比赛吧！";return B(()=>{M()}),(s,t)=>{const l=N("router-link");return o(),d("div",Y,[t[16]||(t[16]=e("div",{class:"replay-header"},[e("h1",{class:"replay-title"},"对局回放"),e("p",{class:"replay-subtitle"},"回顾精彩棋局，学习对弈技巧")],-1)),y.value?(o(),d("div",z,t[3]||(t[3]=[e("div",{class:"spinner"},null,-1),e("p",null,"正在加载回放数据...",-1)]))):b.value?(o(),d("div",A,[t[4]||(t[4]=e("i",{class:"fas fa-exclamation-circle"},null,-1)),e("p",null,i(b.value),1)])):(o(),d("div",Q,[e("div",T,[e("div",j,[e("button",{class:f(["filter-btn",{active:u.value==="all"}]),onClick:t[0]||(t[0]=r=>k("all"))},"全部",2),e("button",{class:f(["filter-btn",{active:u.value==="win"}]),onClick:t[1]||(t[1]=r=>k("win"))},"我的胜局",2),e("button",{class:f(["filter-btn",{active:u.value==="loss"}]),onClick:t[2]||(t[2]=r=>k("loss"))},"我的败局",2)])]),v.value.length>0?(o(),d("div",G,[(o(!0),d(q,null,E(v.value,r=>{var a,n;return o(),d("div",{key:r.id,class:"replay-card"},[e("div",J,[e("div",K,[t[5]||(t[5]=e("i",{class:"fas fa-hashtag"},null,-1)),S(" "+i(r.id),1)]),e("div",{class:f(["game-result",V(r)])},i(L(r)),3)]),e("div",O,[e("div",P,[e("div",W,[t[6]||(t[6]=e("div",{class:"stone stone-black"},null,-1)),e("span",X,i(((a=r.black_player)==null?void 0:a.username)||"未知"),1)]),t[8]||(t[8]=e("div",{class:"vs-badge"},"VS",-1)),e("div",Z,[t[7]||(t[7]=e("div",{class:"stone stone-white"},null,-1)),e("span",tt,i(((n=r.white_player)==null?void 0:n.username)||"未知"),1)])]),e("div",et,[e("div",st,[t[9]||(t[9]=e("i",{class:"fas fa-calendar"},null,-1)),e("span",null,i($(r.start_time,"date")),1)]),e("div",lt,[t[10]||(t[10]=e("i",{class:"fas fa-clock"},null,-1)),e("span",null,i($(r.start_time,"time")),1)]),e("div",{class:f(["detail-item",{"in-progress":!r.end_time}])},[t[11]||(t[11]=e("i",{class:"fas fa-hourglass-end"},null,-1)),e("span",null,i(r.end_time?R(r.start_time,r.end_time):"进行中"),1)],2)])]),e("div",rt,[C(l,{to:`/replay/${r.id}`,class:"watch-btn"},{default:x(()=>t[12]||(t[12]=[e("i",{class:"fas fa-play-circle"},null,-1),S(" 观看回放 ")])),_:2},1032,["to"])])])}),128))])):(o(),d("div",at,[t[14]||(t[14]=e("i",{class:"fas fa-film"},null,-1)),t[15]||(t[15]=e("p",null,"暂无回放记录",-1)),e("p",nt,i(F()),1),C(l,{to:"/new-game",class:"start-game-btn"},{default:x(()=>t[13]||(t[13]=[e("i",{class:"fas fa-gamepad"},null,-1),S(" 开始新游戏 ")])),_:1})]))]))])}}},ut=U(it,[["__scopeId","data-v-96b49f7c"]]);export{ut as default};
