import{_ as C,h as F,u as j,i as n,s as B,a as r,b as d,d as e,g as G,e as m,t as v,l as k,q as x,m as _}from"./index-358441f2.js";const S={class:"new-game-container"},$={class:"row justify-content-center"},q={class:"col-md-8"},R={class:"game-card"},T={class:"card-body p-4"},z={class:"d-grid gap-2"},A=["disabled"],D={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},E={key:1},L={key:0,class:"error-box"},P={class:"modal-dialog modal-dialog-centered",role:"document"},U={class:"modal-content"},H={class:"modal-header"},J={class:"modal-title"},K={class:"modal-body text-center py-4"},O={key:0},Q={class:"matching-time mt-3"},W={key:1,class:"match-found"},X={class:"opponent-info mt-3"},Y={class:"opponent-name"},Z={class:"modal-footer"},ee={__name:"NewGameView",setup(ae){const w=F();j();const b=n(!1),c=n(null),u=n(!1),l=n(!1),y=n(""),o=n(null),p=n(null),h=n(0);let f=null;async function I(){var s,a;if(!b.value)try{b.value=!0,c.value=null;const i=await _.get("/api/matches/check");if(i.data.status==="match_found")o.value=i.data.match_id,y.value=i.data.player1_username,await N(o.value);else{const t=await _.post("/api/matches/create");t.data.status==="success"?(o.value=t.data.match_id,p.value=t.data.game_id,u.value=!0,l.value=!1,h.value=0,f=setInterval(()=>{h.value++,h.value%1===0&&M()},1e3)):c.value="创建匹配失败，请重试"}}catch(i){console.error("Failed to start matchmaking:",i),c.value="匹配失败："+(((a=(s=i.response)==null?void 0:s.data)==null?void 0:a.message)||i.message||"未知错误")}finally{b.value=!1}}async function M(){if(o.value)try{const s=await _.get(`/api/matches/${o.value}`);s.data.status==="closed"&&s.data.player2_id&&(l.value=!0,y.value=s.data.player2_username,p.value=s.data.game_id,clearInterval(f))}catch(s){console.error("Failed to check match status:",s)}}async function g(){if(u.value)try{o.value&&await _.post(`/api/matches/cancel/${o.value}`)}catch(s){console.error("Failed to cancel match:",s)}finally{u.value=!1,l.value=!1,o.value=null,y.value="",clearInterval(f)}}async function N(s){var a,i;try{const t=await _.post(`/api/matches/join/${s}`);t.data.status==="success"?(p.value=t.data.game_id,u.value=!0,l.value=!0):c.value="加入游戏失败："+(t.data.message||"未知错误")}catch(t){console.error("Failed to join match:",t),c.value="加入游戏失败："+(((i=(a=t.response)==null?void 0:a.data)==null?void 0:i.message)||t.message||"未知错误")}}function V(){p.value&&w.push(`/game/${p.value}`)}return B(()=>{f&&clearInterval(f),u.value&&!l.value&&g()}),(s,a)=>(r(),d("div",S,[a[13]||(a[13]=e("div",{class:"text-center mb-5"},[e("h1",{class:"display-4 fw-bold text-gradient"},"开始新游戏"),e("p",{class:"lead text-muted"},"开始一场精彩的对决！")],-1)),e("div",$,[e("div",q,[e("div",R,[e("div",T,[a[2]||(a[2]=G('<div class="d-flex align-items-center mb-4" data-v-be977b61><i class="bi bi-controller me-3 text-primary" style="font-size:2rem;" data-v-be977b61></i><h3 class="card-title mb-0" data-v-be977b61>开始游戏</h3></div><div class="info-box mb-4" data-v-be977b61><i class="bi bi-info-circle me-2" data-v-be977b61></i><span data-v-be977b61>点击&quot;开始匹配&quot;按钮开始匹配对手，系统会自动为您寻找合适的对手。</span></div>',2)),e("div",z,[e("button",{onClick:I,class:"btn btn-primary btn-lg start-btn",disabled:b.value},[b.value?(r(),d("span",D)):(r(),d("span",E,a[0]||(a[0]=[e("i",{class:"bi bi-play-fill me-2"},null,-1)]))),a[1]||(a[1]=m(" 开始匹配 "))],8,A)])])]),c.value?(r(),d("div",L,[a[3]||(a[3]=e("i",{class:"bi bi-exclamation-circle me-2"},null,-1)),m(" "+v(c.value),1)])):k("",!0)])]),e("div",{class:x(["modal fade",{"show d-block":u.value}]),tabindex:"-1",role:"dialog","aria-hidden":"true"},[e("div",P,[e("div",U,[e("div",H,[e("h5",J,[e("i",{class:x(["bi",l.value?"bi-check-circle-fill text-success":"bi-hourglass-split text-primary"])},null,2),m(" "+v(l.value?"已找到对手！":"正在匹配中..."),1)]),e("button",{type:"button",class:"btn-close",onClick:g})]),e("div",K,[l.value?(r(),d("div",W,[a[9]||(a[9]=e("div",{class:"success-icon mb-4"},[e("i",{class:"bi bi-check-circle-fill"})],-1)),a[10]||(a[10]=e("h4",null,"匹配成功！",-1)),e("div",X,[a[8]||(a[8]=e("i",{class:"bi bi-person-circle me-2"},null,-1)),e("span",Y,v(y.value),1)])])):(r(),d("div",O,[a[5]||(a[5]=e("div",{class:"matching-animation mb-4"},[e("div",{class:"spinner-border text-primary",style:{width:"4rem",height:"4rem"},role:"status"},[e("span",{class:"visually-hidden"},"正在匹配...")])],-1)),a[6]||(a[6]=e("h4",{class:"mt-3"},"寻找对手中...",-1)),a[7]||(a[7]=e("p",{class:"text-muted mb-0"},"请等待，或点击取消停止匹配",-1)),e("div",Q,[a[4]||(a[4]=e("i",{class:"bi bi-clock me-2"},null,-1)),m(" "+v(Math.floor(h.value/60))+"分 "+v(h.value%60)+"秒 ",1)])]))]),e("div",Z,[e("button",{type:"button",class:"btn btn-secondary",onClick:g},[a[11]||(a[11]=e("i",{class:"bi bi-x-circle me-2"},null,-1)),m(" "+v(l.value?"取消":"停止匹配"),1)]),l.value?(r(),d("button",{key:0,type:"button",class:"btn btn-primary",onClick:V},a[12]||(a[12]=[e("i",{class:"bi bi-play-fill me-2"},null,-1),m(" 进入游戏 ")]))):k("",!0)])])])],2)]))}},te=C(ee,[["__scopeId","data-v-be977b61"]]);export{te as default};
