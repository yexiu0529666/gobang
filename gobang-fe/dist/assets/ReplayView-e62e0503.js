import{_ as Y,x as Z,h as j,c as F,i as o,y as ee,o as le,s as se,r as ae,a as p,b as f,d as e,f as te,w as ne,F as w,p as C,g as oe,t as u,q as _,n as M,k as ie,v as re,l as I,m as ue,e as ce}from"./index-358441f2.js";const ve={class:"replay-container"},de={class:"replay-content"},pe={class:"row"},fe={class:"col-md-8"},be={class:"game-board-card"},_e={class:"card-header"},ye={class:"header-content"},me={class:"card-body"},ge={class:"game-board"},ke={class:"board-container"},he={class:"board-grid"},xe={key:0,class:"last-move-mark"},we={class:"col-md-4"},Ce={class:"control-panel"},Me={class:"game-info-section"},$e={class:"info-grid"},Se={class:"info-item"},Ve={class:"info-value"},Ie={class:"info-item"},Re={class:"info-value"},Te={class:"info-item"},Be={class:"info-item"},Pe={class:"info-value"},Ae={class:"info-item"},De={class:"info-value"},Ne={class:"playback-controls"},ze={class:"progress-section"},Fe={class:"progress-info"},Ee={class:"progress-bar-container"},Le={class:"speed-control"},Ue={class:"speed-slider"},qe={class:"control-buttons"},He=["disabled"],We=["disabled"],Ge=["disabled"],Je=["disabled"],Ke={__name:"ReplayView",setup(Oe){const E=Z();j();const L=F(()=>E.params.id),U=o(null),c=o(null),y=o(Array(15).fill().map(()=>Array(15).fill(0))),a=o([]),t=o(-1),v=o(null),d=o(!1),m=o(1),b=o(null),g=o(""),$=o("alert-info"),S=o(!0),q=o(null),H=async()=>{try{S.value=!0;const s=await ue.get(`/api/replay/${L.value}`);c.value=s.data;const l=[...s.data.moves].sort((i,x)=>i.move_number-x.move_number);a.value=l.map(i=>({x:i.x,y:i.y,player_id:i.player_id,color:i.move_number%2===1?1:2,timestamp:new Date(i.timestamp),move_number:i.move_number})),S.value=!1,r("回放准备就绪，点击播放按钮开始回放","alert-info")}catch(s){console.error("Failed to fetch replay data:",s),q.value="无法加载回放数据，请稍后再试",S.value=!1,r("加载回放数据失败","alert-danger")}},R=(s,l)=>y.value[s][l],W=(s,l)=>v.value&&v.value.x===s&&v.value.y===l,V=()=>{y.value=Array(15).fill().map(()=>Array(15).fill(0)),v.value=null},G=()=>{d.value?k():T()},T=()=>{if(d.value)return;t.value>=a.value.length-1&&(V(),t.value=-1),d.value=!0,r("正在播放回放","alert-info");const s=1e3/m.value;b.value=setInterval(()=>{B(),t.value>=a.value.length-1&&(k(),r("回放结束","alert-success"))},s)},k=()=>{d.value&&(d.value=!1,b.value&&(clearInterval(b.value),b.value=null),r("回放已暂停","alert-warning"))},B=()=>{if(t.value>=a.value.length-1){r("已经是最后一步","alert-warning");return}t.value++;const s=a.value[t.value];y.value[s.x][s.y]=s.color,v.value={x:s.x,y:s.y}},J=()=>{if(t.value<0){r("已经是第一步","alert-warning");return}const s=a.value[t.value];if(y.value[s.x][s.y]=0,t.value--,t.value>=0){const l=a.value[t.value];v.value={x:l.x,y:l.y}}else v.value=null},K=()=>{k(),V(),t.value=-1,r("回到开始位置","alert-info")},O=()=>{k(),V();for(let s=0;s<a.value.length;s++){const l=a.value[s];y.value[l.x][l.y]=l.color}if(a.value.length>0){const s=a.value[a.value.length-1];v.value={x:s.x,y:s.y},t.value=a.value.length-1}r("跳转到结束位置","alert-info")},P=F(()=>a.value.length===0?0:(t.value+1)/a.value.length*100),Q=()=>{switch($.value){case"alert-info":return"bi bi-info-circle";case"alert-success":return"bi bi-check-circle";case"alert-warning":return"bi bi-exclamation-circle";case"alert-danger":return"bi bi-x-circle";default:return"bi bi-info-circle"}},X=()=>{var s,l;return(s=c.value)!=null&&s.winner?c.value.winner.id===((l=c.value.black_player)==null?void 0:l.id)?"text-dark":"text-light":"text-secondary"},r=(s,l="alert-info")=>{g.value=s,$.value=l,l==="alert-info"&&setTimeout(()=>{g.value===s&&(g.value="")},3e3)};return ee(m,s=>{d.value&&(k(),T())}),le(()=>{H()}),se(()=>{b.value&&clearInterval(b.value)}),(s,l)=>{var x,A,D,N,z;const i=ae("router-link");return p(),f("div",ve,[l[17]||(l[17]=e("div",{class:"replay-header"},[e("h1",{class:"replay-title"},"游戏回放"),e("p",{class:"replay-subtitle"},"重温精彩对局，学习对弈技巧")],-1)),e("div",de,[e("div",pe,[e("div",fe,[e("div",be,[e("div",_e,[e("div",ye,[l[2]||(l[2]=e("h3",null,"对局棋盘",-1)),te(i,{to:"/replays",class:"back-btn"},{default:ne(()=>l[1]||(l[1]=[e("i",{class:"bi bi-arrow-left"},null,-1),ce(" 返回列表 ")])),_:1})])]),e("div",me,[e("div",ge,[e("div",ke,[e("div",{class:"board",ref_key:"boardRef",ref:U},[e("div",he,[(p(),f(w,null,C(15,n=>e("div",{key:`h-${n}`,class:"grid-line horizontal",style:M({top:`${(n-1)*100/14}%`})},null,4)),64)),(p(),f(w,null,C(15,n=>e("div",{key:`v-${n}`,class:"grid-line vertical",style:M({left:`${(n-1)*100/14}%`})},null,4)),64)),l[3]||(l[3]=oe('<div class="mark-point" style="top:calc(7 * 100% / 14);left:calc(7 * 100% / 14);" data-v-a6a95c5a></div><div class="mark-point" style="top:calc(3 * 100% / 14);left:calc(3 * 100% / 14);" data-v-a6a95c5a></div><div class="mark-point" style="top:calc(3 * 100% / 14);left:calc(11 * 100% / 14);" data-v-a6a95c5a></div><div class="mark-point" style="top:calc(11 * 100% / 14);left:calc(3 * 100% / 14);" data-v-a6a95c5a></div><div class="mark-point" style="top:calc(11 * 100% / 14);left:calc(11 * 100% / 14);" data-v-a6a95c5a></div>',5))]),(p(),f(w,null,C(15,n=>e("div",{key:`row-${n}`,class:"board-row"},[(p(),f(w,null,C(15,h=>e("div",{key:`point-${n}-${h}`,class:"board-point",style:M({top:`${(n-1)*100/14}%`,left:`${(h-1)*100/14}%`})},[R(n-1,h-1)?(p(),f("div",{key:0,class:_(["stone",R(n-1,h-1)===1?"stone-black":"stone-white"])},[W(n-1,h-1)?(p(),f("div",xe)):I("",!0)],2)):I("",!0)],4)),64))])),64))],512)])])])])]),e("div",we,[e("div",Ce,[e("div",Me,[l[9]||(l[9]=e("h4",null,"对局信息",-1)),e("div",$e,[e("div",Se,[l[4]||(l[4]=e("div",{class:"info-label"},"黑方",-1)),e("div",Ve,u(((A=(x=c.value)==null?void 0:x.black_player)==null?void 0:A.username)||"未知"),1)]),e("div",Ie,[l[5]||(l[5]=e("div",{class:"info-label"},"白方",-1)),e("div",Re,u(((N=(D=c.value)==null?void 0:D.white_player)==null?void 0:N.username)||"未知"),1)]),e("div",Te,[l[6]||(l[6]=e("div",{class:"info-label"},"获胜方",-1)),e("div",{class:_(["info-value",X()])},u((z=c.value)!=null&&z.winner?c.value.winner.username:"平局"),3)]),e("div",Be,[l[7]||(l[7]=e("div",{class:"info-label"},"落子总数",-1)),e("div",Pe,u(a.value.length),1)]),e("div",Ae,[l[8]||(l[8]=e("div",{class:"info-label"},"当前步数",-1)),e("div",De,u(t.value+1)+" / "+u(a.value.length),1)])])]),e("div",Ne,[l[16]||(l[16]=e("h4",null,"回放控制",-1)),e("div",ze,[e("div",Fe,[l[10]||(l[10]=e("span",null,"播放进度",-1)),e("span",null,u(Math.round(P.value))+"%",1)]),e("div",Ee,[e("div",{class:"progress-bar",style:M({width:P.value+"%"})},null,4)])]),e("div",Le,[e("label",null,"播放速度: "+u(m.value)+"x",1),e("div",Ue,[ie(e("input",{type:"range",min:"0.5",max:"3",step:"0.5","onUpdate:modelValue":l[0]||(l[0]=n=>m.value=n)},null,512),[[re,m.value]]),l[11]||(l[11]=e("div",{class:"speed-marks"},[e("span",null,"0.5x"),e("span",null,"1x"),e("span",null,"1.5x"),e("span",null,"2x"),e("span",null,"2.5x"),e("span",null,"3x")],-1))])]),e("div",qe,[e("button",{class:"control-btn",onClick:K,disabled:t.value===-1},l[12]||(l[12]=[e("i",{class:"bi bi-skip-start-fill"},null,-1)]),8,He),e("button",{class:"control-btn",onClick:J,disabled:t.value===-1},l[13]||(l[13]=[e("i",{class:"bi bi-skip-backward-fill"},null,-1)]),8,We),e("button",{class:_(["control-btn play-btn",{playing:d.value}]),onClick:G},[e("i",{class:_(d.value?"bi bi-pause-fill":"bi bi-play-fill")},null,2)],2),e("button",{class:"control-btn",onClick:B,disabled:t.value>=a.value.length-1},l[14]||(l[14]=[e("i",{class:"bi bi-skip-forward-fill"},null,-1)]),8,Ge),e("button",{class:"control-btn",onClick:O,disabled:t.value>=a.value.length-1},l[15]||(l[15]=[e("i",{class:"bi bi-skip-end-fill"},null,-1)]),8,Je)])]),g.value?(p(),f("div",{key:0,class:_(["status-message",$.value])},[e("i",{class:_(Q())},null,2),e("span",null,u(g.value),1)],2)):I("",!0)])])])])])}}},Xe=Y(Ke,[["__scopeId","data-v-a6a95c5a"]]);export{Xe as default};
