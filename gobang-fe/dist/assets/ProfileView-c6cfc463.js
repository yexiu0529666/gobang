import{_ as T,u as F,i as f,c as $,o as B,a as v,b as c,d as s,e as p,t as u,l as _,n as N,j as R,F as U,k as g,v as b,m as D}from"./index-358441f2.js";const h={class:"profile-container"},j={class:"profile-card"},z={class:"profile-section user-info-section"},A={class:"section-header"},I={class:"action-buttons"},L={key:0,class:"user-info-content"},G={class:"info-group"},H={class:"info-value"},J={class:"info-group"},K={class:"info-value"},O={class:"info-group"},Q={class:"info-value"},W={class:"profile-section stats-section"},X={class:"stats-grid"},Y={class:"stat-card"},Z={class:"stat-info"},ss={class:"stat-value"},ls={class:"stat-card"},as={class:"stat-info"},es={class:"stat-value"},ts={class:"stat-card"},os={class:"stat-info"},is={class:"stat-value"},ns={class:"rating-card"},rs={class:"rating-content"},ds={class:"rating-value"},us={class:"rating-progress"},vs={key:0,class:"custom-modal"},cs={class:"modal-container"},fs={class:"modal-header"},ps={class:"modal-title"},ms={class:"modal-body"},ws={class:"form-group"},_s={class:"input-with-icon"},gs={class:"form-group"},bs={class:"input-with-icon"},ys={class:"form-group"},Ps={class:"input-with-icon"},ks={class:"form-group"},xs={class:"input-with-icon"},Es={class:"form-group"},Vs={class:"input-with-icon"},Ms={key:2,class:"alert alert-error"},Cs={key:3,class:"alert alert-success"},Us={class:"modal-footer"},Ss=["disabled"],qs={key:0,class:"spinner"},Ts={key:1},Fs={__name:"ProfileView",setup($s){const x=F(),a=f(null),y=f(!1),e=f(""),m=f(""),k=f(!1),n=f(""),S=$(()=>n.value==="email"?"修改邮箱":"修改密码"),r=f({newEmail:"",currentPassword:""}),t=f({currentPassword:"",newPassword:"",confirmPassword:""}),q=()=>{var w;const d=((w=a.value)==null?void 0:w.rating)||1e3,l=800,o=2e3;return Math.min(100,Math.max(0,(d-l)/(o-l)*100))},E=d=>{n.value=d,k.value=!0,e.value="",m.value="",d==="email"&&a.value&&a.value.email&&(r.value.newEmail=a.value.email)},P=()=>{k.value=!1,r.value={newEmail:"",currentPassword:""},t.value={currentPassword:"",newPassword:"",confirmPassword:""},e.value="",m.value=""},V=async()=>{var d,l;if(e.value="",m.value="",n.value==="email"){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.value.newEmail)){e.value="请输入有效的邮箱地址";return}}else if(n.value==="password"){if(t.value.newPassword!==t.value.confirmPassword){e.value="新密码和确认密码不匹配";return}if(t.value.newPassword.length<6){e.value="新密码长度至少为6个字符";return}}try{y.value=!0;const o=n.value==="email"?{email:r.value.newEmail,current_password:r.value.currentPassword}:{current_password:t.value.currentPassword,new_password:t.value.newPassword},w=await D.put("/api/me",o);m.value=n.value==="email"?"邮箱修改成功":"密码修改成功",n.value==="email"&&(a.value.email=r.value.newEmail),setTimeout(()=>{P()},2e3)}catch(o){console.error("Error updating profile:",o),(l=(d=o.response)==null?void 0:d.data)!=null&&l.error?e.value=o.response.data.error:e.value=n.value==="email"?"修改邮箱失败，请稍后重试":"修改密码失败，请稍后重试"}finally{y.value=!1}};return B(async()=>{try{await x.fetchUser(),a.value=x.currentUser,a.value||(e.value="获取用户信息失败，请刷新页面重试")}catch(d){console.error("Error loading profile:",d),e.value="获取用户信息失败，请刷新页面重试"}}),(d,l)=>{var o,w,M,C;return v(),c("div",h,[l[39]||(l[39]=s("div",{class:"profile-header"},[s("h1",{class:"profile-title"},"个人资料"),s("p",{class:"profile-subtitle"},"查看并管理您的账号信息和游戏数据")],-1)),s("div",j,[s("div",z,[s("div",A,[l[9]||(l[9]=s("h2",null,[s("i",{class:"fas fa-user-circle"}),p(" 基本信息")],-1)),s("div",I,[s("button",{class:"btn-action email",onClick:l[0]||(l[0]=i=>E("email"))},l[7]||(l[7]=[s("i",{class:"fas fa-envelope"},null,-1),p(" 修改邮箱 ")])),s("button",{class:"btn-action password",onClick:l[1]||(l[1]=i=>E("password"))},l[8]||(l[8]=[s("i",{class:"fas fa-key"},null,-1),p(" 修改密码 ")]))])]),a.value?(v(),c("div",L,[s("div",G,[l[11]||(l[11]=s("label",null,"用户名",-1)),s("div",H,[l[10]||(l[10]=s("i",{class:"fas fa-user"},null,-1)),s("span",null,u(a.value.username),1)])]),s("div",J,[l[13]||(l[13]=s("label",null,"邮箱",-1)),s("div",K,[l[12]||(l[12]=s("i",{class:"fas fa-envelope"},null,-1)),s("span",null,u(a.value.email||"未设置"),1)])]),s("div",O,[l[15]||(l[15]=s("label",null,"账号创建时间",-1)),s("div",Q,[l[14]||(l[14]=s("i",{class:"fas fa-calendar-alt"},null,-1)),s("span",null,u(a.value.created_at||"未知"),1)])])])):_("",!0)]),s("div",W,[l[25]||(l[25]=s("div",{class:"section-header"},[s("h2",null,[s("i",{class:"fas fa-chart-line"}),p(" 游戏统计")])],-1)),s("div",X,[s("div",Y,[l[17]||(l[17]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-gamepad"})],-1)),s("div",Z,[s("div",ss,u(((o=a.value)==null?void 0:o.total_games)||0),1),l[16]||(l[16]=s("div",{class:"stat-label"},"总场次",-1))])]),s("div",ls,[l[19]||(l[19]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-trophy"})],-1)),s("div",as,[s("div",es,u(((w=a.value)==null?void 0:w.games_won)||0),1),l[18]||(l[18]=s("div",{class:"stat-label"},"胜场",-1))])]),s("div",ts,[l[21]||(l[21]=s("div",{class:"stat-icon"},[s("i",{class:"fas fa-percentage"})],-1)),s("div",os,[s("div",is,u(((M=a.value)==null?void 0:M.win_rate)||0)+"%",1),l[20]||(l[20]=s("div",{class:"stat-label"},"胜率",-1))])])]),s("div",ns,[l[24]||(l[24]=s("div",{class:"rating-header"},[s("h3",null,[s("i",{class:"fas fa-star"}),p(" 当前积分")])],-1)),s("div",rs,[s("div",ds,u(((C=a.value)==null?void 0:C.rating)||1e3),1),s("div",us,[s("div",{class:"progress-bar",style:N({width:`${q()}%`})},null,4)]),l[22]||(l[22]=s("div",{class:"rating-tiers"},[s("span",null,"新手"),s("span",null,"业余"),s("span",null,"专业"),s("span",null,"大师")],-1)),l[23]||(l[23]=s("p",{class:"rating-info"},"初始积分为1000，胜场+10，负场-10",-1))])])])]),k.value?(v(),c("div",vs,[s("div",{class:"modal-overlay",onClick:P}),s("div",cs,[s("div",fs,[s("h3",ps,u(S.value),1),s("button",{class:"modal-close",onClick:P},l[26]||(l[26]=[s("i",{class:"fas fa-times"},null,-1)]))]),s("div",ms,[s("form",{onSubmit:R(V,["prevent"])},[n.value==="email"?(v(),c(U,{key:0},[s("div",ws,[l[28]||(l[28]=s("label",null,"新邮箱",-1)),s("div",_s,[l[27]||(l[27]=s("i",{class:"fas fa-envelope"},null,-1)),g(s("input",{type:"email","onUpdate:modelValue":l[2]||(l[2]=i=>r.value.newEmail=i),required:""},null,512),[[b,r.value.newEmail]])])]),s("div",gs,[l[30]||(l[30]=s("label",null,"当前密码",-1)),s("div",bs,[l[29]||(l[29]=s("i",{class:"fas fa-lock"},null,-1)),g(s("input",{type:"password","onUpdate:modelValue":l[3]||(l[3]=i=>r.value.currentPassword=i),required:""},null,512),[[b,r.value.currentPassword]])])])],64)):_("",!0),n.value==="password"?(v(),c(U,{key:1},[s("div",ys,[l[32]||(l[32]=s("label",null,"当前密码",-1)),s("div",Ps,[l[31]||(l[31]=s("i",{class:"fas fa-lock"},null,-1)),g(s("input",{type:"password","onUpdate:modelValue":l[4]||(l[4]=i=>t.value.currentPassword=i),required:""},null,512),[[b,t.value.currentPassword]])])]),s("div",ks,[l[34]||(l[34]=s("label",null,"新密码",-1)),s("div",xs,[l[33]||(l[33]=s("i",{class:"fas fa-key"},null,-1)),g(s("input",{type:"password","onUpdate:modelValue":l[5]||(l[5]=i=>t.value.newPassword=i),required:""},null,512),[[b,t.value.newPassword]])])]),s("div",Es,[l[36]||(l[36]=s("label",null,"确认新密码",-1)),s("div",Vs,[l[35]||(l[35]=s("i",{class:"fas fa-check-circle"},null,-1)),g(s("input",{type:"password","onUpdate:modelValue":l[6]||(l[6]=i=>t.value.confirmPassword=i),required:""},null,512),[[b,t.value.confirmPassword]])])])],64)):_("",!0),e.value?(v(),c("div",Ms,[l[37]||(l[37]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),p(" "+u(e.value),1)])):_("",!0),m.value?(v(),c("div",Cs,[l[38]||(l[38]=s("i",{class:"fas fa-check-circle"},null,-1)),p(" "+u(m.value),1)])):_("",!0)],32)]),s("div",Us,[s("button",{class:"btn-cancel",onClick:P},"取消"),s("button",{class:"btn-submit",onClick:V,disabled:y.value},[y.value?(v(),c("span",qs)):(v(),c("span",Ts,"确认修改"))],8,Ss)])])])):_("",!0)])}}},Ns=T(Fs,[["__scopeId","data-v-107dfbf4"]]);export{Ns as default};
